<!DOCTYPE html>
<html lang="en-US">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Food Pantry Detail View | Survivors Unrestrained</title>
    <link rel="canonical" href="https://survivorsunrestrained.org/finding-purpose-through-connection-ian-uedas-story/" />
    <meta name='robots' content='max-image-preview:large' />
    
    <link rel="pingback" href="https://survivorsunrestrained.org/xmlrpc.php" />
    <link rel='dns-prefetch' href='//fonts.googleapis.com' />
    <link rel="alternate" type="application/rss+xml" title="Survivors Unrestrained &raquo; Feed" href="https://survivorsunrestrained.org/feed/" />
    <link rel="alternate" type="application/rss+xml" title="Survivors Unrestrained &raquo; Comments Feed" href="https://survivorsunrestrained.org/comments/feed/" />

    <!-- 1. Custom Header Styles -->
    <style>
        /* 1. Basic Reset and Global Styles */
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            color: #333;
            line-height: 1.6;
            background-color: #f4f7f6; /* Set background here for consistency */
        }

        /* 2. Header Structure */
        #main-header {
            background-color: #ffffff;
            border-bottom: 1px solid #eee;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            padding: 10px 0;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between; /* Space logo and nav */
            align-items: center; /* Vertically center items */
        }
        
        /* 3. Logo Styling */
        #logo {
            max-height: 50px; /* Limit logo height */
            width: auto;
            display: block;
        }
        
        /* 4. Navigation Menu Styling */
        #top-menu {
            list-style: none;
            padding: 0;
            margin: 0;
            display: flex; /* Horizontal menu */
        }

        #top-menu li {
            margin-left: 25px; /* Spacing between links */
        }

        #top-menu a {
            text-decoration: none;
            color: #555;
            font-weight: 600;
            font-size: 16px;
            padding: 5px 0;
            transition: color 0.3s ease;
        }

        #top-menu a:hover {
            color: #4CAF50; /* Changed hover color to match primary green */
        }

        /* 5. Content Area Padding for visual separation */
        main {
            padding: 40px 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        /* 6. Detail View Custom Styles (for readability) */
        .detail-label {
            font-weight: 600;
            color: #6b7280; /* Gray 500 */
        }
        .detail-value {
            color: #1f2937; /* Gray 800 */
            word-break: break-word;
        }
    </style>

    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // Tailwind Configuration
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary': '#4CAF50',
                        'secondary': '#FF9800',
                        'background': '#f4f7f6',
                        'card': '#ffffff',
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                }
            }
        }
    </script>
</head>
<body>

    <div id="page-container">

        <header id="main-header">
            <div class="container">
                <div class="logo-container">
                    <a href="https://survivorsunrestrained.org/">
                        <img 
                            src="https://survivorsunrestrained.org/wp-content/uploads/2024/08/SurvivorsUR-Web-Logo.png" 
                            alt="Survivors Unrestrained" 
                            id="logo" 
                        />
                    </a>
                </div>
                
                <nav id="top-menu-nav">
                    <ul id="top-menu" class="nav">
                        <li><a href="https://survivorsunrestrained.org/">Home</a></li>
                        <li><a href="https://survivorsunrestrained.org/blog/">Blog</a></li>
                    </ul>
                </nav>
            </div>
        </header>
        
        <main>
            <!-- Main Content Container for Pantry Detail -->
            <div id="app-container" class="max-w-4xl mx-auto">
                <div class="mb-8">
                    <h1 class="text-3xl font-extrabold text-gray-900 mb-2">Food Pantry Resource Browser</h1>
                    <p class="text-gray-600">Select a state to view a list of available food pantry records. Click any item in the list to view its full details.</p>
                </div>

                <!-- Controls and Filepath Display -->
                <div class="mb-6">
                    <div class="flex flex-col sm:flex-row sm:gap-4 mb-2">
                        <!-- State Selector -->
                        <div class="flex-grow sm:w-1/3 mb-4 sm:mb-0">
                            <label for="state-selector" class="block text-sm font-medium text-gray-700 mb-1">Select a State:</label>
                            <select id="state-selector" class="mt-1 block w-full py-2 px-3 border border-gray-300 bg-white rounded-lg shadow-sm focus:outline-none focus:ring-primary focus:border-primary sm:text-lg cursor-pointer transition duration-150 ease-in-out">
                                <option value="" disabled selected>Choose State</option>
                            </select>
                        </div>
                        <!-- New Search Input -->
                        <div class="flex-grow sm:w-2/3">
                            <label for="search-input" class="block text-sm font-medium text-gray-700 mb-1">Filter by Name or City:</label>
                            <input type="text" id="search-input" placeholder="Start typing to filter results..." disabled class="mt-1 block w-full py-2 px-3 border border-gray-300 bg-white rounded-lg shadow-sm focus:outline-none focus:ring-primary focus:border-primary sm:text-lg transition duration-150 ease-in-out">
                        </div>
                    </div>
                    <!-- Display the full fetching path for debugging -->
                    <p id="filepath-display" class="mt-2 text-sm text-gray-500 font-mono break-all min-h-[1.5rem]"></p>
                </div>

                <!-- Card container where the list/details will be rendered -->
                <div id="pantry-card-container">
                    <!-- Initial message shown until a state is selected -->
                    <div id="initial-message" class="bg-card p-6 rounded-xl shadow-lg text-center">
                        <p class="text-xl text-primary animate-pulse">Select a State to load data...</p>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- JavaScript Logic -->
    <script>
        let rawDataset = [];       // Stores the original, unfiltered dataset
        let currentDataset = [];   // Stores the currently displayed (filtered) dataset
        let currentStateCode = null; // Store the currently loaded state

        /**
         * Fetches the entire dataset array for a given state.
         * @param {string} stateCode The two-letter state code (e.g., 'ak', 'ca').
         * @returns {Promise<Object>} A promise resolving to an object containing the data array, error message, and file URL.
         */
        async function fetchDatasetByState(stateCode) {
            if (!stateCode) return { data: null, url: null };

            // Construct the dynamic file path as requested: ../Private/Datasets/<inputstate>_food_pantries_202510.json
            const url = `./Datasets/${stateCode.toLowerCase()}_food_pantries_202510.json`;
            console.log('Attempting to fetch data from:', url);

            try {
                const response = await fetch(url);
                
                if (!response.ok) {
                    console.error('Failed to fetch data for state:', stateCode, response.status);
                    // Check if the response body has JSON to extract a specific error message
                    const errorText = await response.text();
                    let errorMessage = errorText || `Dataset for ${stateCode.toUpperCase()} not found or failed to load. (Status: ${response.status})`;
                    return { error: errorMessage, url: url };
                }

                const data = await response.json();
                return { data: data, url: url };

            } catch (e) {
                console.error('Network or parsing error:', e);
                return { error: `A network or parsing error occurred while loading data for ${stateCode.toUpperCase()}. Error: ${e.message}`, url: url };
            }
        }

        // --- Helper Functions ---

        /** Creates HTML for a single detail row. */
        function createDetailRow(label, value) {
            if (!value) return '';
            // Simple markdown conversion for new lines in hours/description
            let displayValue = String(value).replace(/\r?\n/g, '<br>');
            
            return `
                <div class="py-2 border-b border-gray-100 flex flex-col sm:flex-row sm:items-baseline">
                    <span class="detail-label w-full sm:w-1/3">${label}:</span>
                    <span class="detail-value w-full sm:w-2/3">${displayValue}</span>
                </div>
            `;
        }

        /** Filters the raw dataset based on a search term and renders the list view. */
        function filterAndRenderList(searchTerm = '') {
            const searchInput = document.getElementById('search-input');
            const term = searchTerm.toLowerCase().trim();

            if (!term) {
                currentDataset = rawDataset;
            } else {
                currentDataset = rawDataset.filter(item => 
                    item.name.toLowerCase().includes(term) || 
                    item.city.toLowerCase().includes(term)
                );
            }

            renderListView(currentDataset, currentStateCode, term);

            // Re-enable search input once data is present
            searchInput.disabled = rawDataset.length === 0;
            searchInput.value = searchTerm;
        }

        /** Handles clicking an item in the list view to switch to detail view. */
        window.handleItemClick = function(id) {
            // Use the currently displayed (filtered) dataset
            const record = currentDataset.find(item => item.id === id);
            if (record) {
                renderDetailView(record);
            } else {
                // Use a custom message box instead of alert()
                document.getElementById('pantry-card-container').innerHTML = `
                    <div class="bg-card p-8 rounded-xl shadow-xl text-center border-l-4 border-red-500">
                        <h2 class="text-2xl font-bold text-red-600 mb-2">Record Not Found</h2>
                        <p class="text-gray-600">Could not find record with ID ${id} in the current dataset.</p>
                        <button onclick="goBackToList()" class="mt-4 bg-primary text-white py-2 px-4 rounded-lg hover:bg-green-700 transition">Back to List</button>
                    </div>
                `;
            }
        };

        /** Returns the view to the last loaded list. */
        window.goBackToList = function() {
            // Re-render the last filtered view
            const searchInput = document.getElementById('search-input');
            filterAndRenderList(searchInput.value);
        };


        // --- Render Views ---

        /** Renders the list of food pantries from the loaded dataset. */
        function renderListView(dataset, stateCode, filterTerm = '') {
            const container = document.getElementById('pantry-card-container');
            
            if (dataset.length === 0 && rawDataset.length > 0) {
                 container.innerHTML = `
                    <div class="bg-card p-8 rounded-xl shadow-xl text-center border-l-4 border-yellow-500">
                        <h2 class="text-2xl font-bold text-yellow-600 mb-2">No Matches Found</h2>
                        <p class="text-gray-600">No food pantries matched the search term <strong>"${filterTerm}"</strong> in ${stateCode.toUpperCase()}. Try a different term.</p>
                    </div>
                `;
                return;
            }
             if (dataset.length === 0 && rawDataset.length === 0) {
                 // This handles the case where the file loaded but was empty
                 container.innerHTML = `<div class="bg-card p-8 rounded-xl shadow-xl text-center border-l-4 border-yellow-500"><h2 class="text-2xl font-bold text-yellow-600 mb-2">No Records Found</h2><p class="text-gray-600">The dataset loaded successfully, but contained no food pantry records for ${stateCode.toUpperCase()}.</p></div>`;
                return;
            }

            const listHtml = dataset.map(item => `
                <li class="p-4 border-b border-gray-200 hover:bg-gray-50 cursor-pointer transition duration-150 ease-in-out" 
                    onclick="handleItemClick(${item.id})">
                    <h3 class="text-xl font-semibold text-primary">${item.name}</h3>
                    <p class="text-sm text-gray-600">${item.city}, ${item.state}</p>
                </li>
            `).join('');

            container.innerHTML = `
                <div class="bg-card p-6 rounded-xl shadow-lg">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">Food Pantries in ${stateCode.toUpperCase()} (${dataset.length} of ${rawDataset.length} shown)</h2>
                    <ul class="divide-y divide-gray-100">${listHtml}</ul>
                </div>
            `;
        }


        /** Renders the detailed card view for a single food pantry record. */
        function renderDetailView(record) {
            const container = document.getElementById('pantry-card-container');
            
            // Format contact links
            const emailLink = record.email ? `<a href="mailto:${record.email}" class="text-primary hover:text-green-700 underline">${record.email}</a>` : 'N/A';
            const websiteLink = record.website ? `<a href="${record.website}" target="_blank" rel="noopener" class="text-primary hover:text-green-700 underline">${record.website}</a>` : 'N/A';
            const phoneLink = record.phone ? `<a href="tel:${record.phone.replace(/[^0-9]/g, '')}" class="text-primary hover:text-green-700 underline">${record.phone}</a>` : 'N/A';

            container.innerHTML = `
                <div class="bg-card p-6 sm:p-8 rounded-xl shadow-2xl transition-all duration-300">
                    
                    <!-- Back Button -->
                    <button onclick="goBackToList()" class="mb-4 text-sm text-primary hover:text-green-700 font-medium flex items-center p-2 rounded-lg transition duration-150 ease-in-out">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
                        </svg>
                        Back to List
                    </button>

                    <!-- Header -->
                    <div class="flex items-center justify-between mb-6 border-b pb-4 border-primary/20">
                        <h2 class="text-3xl font-extrabold text-gray-900">${record.name}</h2>
                        <span class="bg-primary text-white text-sm font-semibold px-3 py-1 rounded-full shadow-md">ID: ${record.id}</span>
                    </div>

                    <!-- Details Grid -->
                    <div class="divide-y divide-gray-200">
                        <!-- Location Section -->
                        <h3 class="text-xl font-semibold text-gray-700 mt-4 mb-2 pt-4">Location</h3>
                        ${createDetailRow('Street Address', record.address)}
                        ${createDetailRow('City, State, Zip', `${record.city}, ${record.state} ${record.zip}`)}
                        ${createDetailRow('Geocoded Address', record.geocoded_address)}
                        <div class="py-2 border-b border-gray-100 flex flex-col sm:flex-row sm:items-baseline">
                            <span class="detail-label w-full sm:w-1/3">Map Coordinates:</span>
                            <span class="detail-value w-full sm:w-2/3">${record.latitude}, ${record.longitude}</span>
                        </div>
                        
                        <!-- Operational Details Section -->
                        <h3 class="text-xl font-semibold text-gray-700 mt-4 mb-2 pt-4">Operation</h3>
                        ${createDetailRow('Hours/Volunteering', record.hours)}
                        ${createDetailRow('Description', record.description)}
                        ${createDetailRow('Requirements', record.requirements || 'None listed')}
                        
                        <!-- Contact Section -->
                        <h3 class="text-xl font-semibold text-gray-700 mt-4 mb-2 pt-4">Contact</h3>
                        ${createDetailRow('Phone', phoneLink)}
                        ${createDetailRow('Email', emailLink)}
                        ${createDetailRow('Website', websiteLink)}
                        
                        <!-- Metadata -->
                        <p class="text-xs text-gray-400 mt-6 pt-4 text-right">Scraped At: ${new Date(record.scraped_at).toLocaleString()}</p>

                    </div>
                </div>
            `;
        }

        // --- Main Controller ---

        /** Function to handle state selection and data fetching. */
        async function handleStateChange() {
            const stateSelector = document.getElementById('state-selector');
            const searchInput = document.getElementById('search-input');
            const pathDisplay = document.getElementById('filepath-display');
            const container = document.getElementById('pantry-card-container');
            const selectedState = stateSelector.value;

            if (!selectedState) {
                container.innerHTML = `<div id="initial-message" class="bg-card p-6 rounded-xl shadow-lg text-center"><p class="text-xl text-primary animate-pulse">Select a State to load data...</p></div>`;
                pathDisplay.textContent = '';
                // Disable search and clear data on reset
                searchInput.disabled = true;
                searchInput.value = '';
                rawDataset = [];
                currentDataset = [];
                currentStateCode = null;
                return;
            }

            pathDisplay.textContent = `Path: Loading data for ${selectedState.toUpperCase()}...`;
            container.innerHTML = `<div class="bg-card p-6 rounded-xl shadow-lg text-center"><p class="text-xl text-primary animate-pulse">Loading dataset for ${selectedState.toUpperCase()}...</p></div>`;

            // Disable search while loading
            searchInput.disabled = true;
            searchInput.value = '';
            rawDataset = [];

            const { data: dataset, url, error } = await fetchDatasetByState(selectedState);
            
            // Display the full fetching path
            pathDisplay.textContent = `Fetching path: ${url}`;

            if (error) {
                container.innerHTML = `<div class="bg-card p-8 rounded-xl shadow-xl text-center border-l-4 border-red-500"><h2 class="text-2xl font-bold text-red-600 mb-2">Error Loading Data</h2><p class="text-gray-600">${error}</p><p class="text-sm mt-4 text-gray-400">Please check if the file path is correct.</p></div>`;
                return;
            }
            
            // Store the full dataset and state code globally
            rawDataset = dataset || [];
            currentStateCode = selectedState;

            // Immediately filter and render (with an empty search term)
            filterAndRenderList('');
        }

        /** Function to attach all necessary event listeners and start the application. */
        function initializeApp() {
            const stateSelector = document.getElementById('state-selector');
            const searchInput = document.getElementById('search-input');

            // Listen for state changes to load new data
            stateSelector.addEventListener('change', handleStateChange);
            
            // Listen for input on the search box to filter the list in real-time
            searchInput.addEventListener('input', (e) => {
                // Only filter if a dataset is currently loaded
                if (rawDataset.length > 0) {
                    filterAndRenderList(e.target.value);
                }
            });
        }

        // Start the application once the DOM is fully loaded
        window.onload = initializeApp;
    </script>
</body>
</html>
